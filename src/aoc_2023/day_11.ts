const p1Input = `..............#..........................#.....................#.....#...................#..................................#...............
.............................#.........................................................................................#..........#.........
#......................#.................................................#.....................#...........#................................
......#..............................#........................................#.............................................................
................................#...........#.........#.............................................................#.....#..........#......
..................#...................................................#...................#.................................................
............................#...............................................................................................................
........#.....#...............................................................................#...............#.............................
#...................................#.....#.........................................#.....................................................#.
..........................................................................#........................#..............#........#........#.......
.....#.....#.............#.......................#..........................................................................................
..............................#.............................#....................#......#...................................................
............................................................................................................................................
.......................................#....................................#........................................#......................
.......#................................................#..............#............................#.......................................
................#.................................................#.........................................#...............................
.....................#.........................#.....................................#......................................................
...............................................................................................#..................................#.........
.#......................................................................................................................#...................
........#...................................................................................................................................
...............................#...........#.............#...............................#...........#...................................#..
.............#.....#.............................................#.....#......................................#.............................
............................................................................................................................................
.......................#...........#.................#..............................#....................................#..................
...............................................................................#.....................................................#......
..#......#.............................#............................#..................................#........................#...........
.............................#..........................#......#...........#................................................................
....................#.........................#..................................................#..........................................
......#............................................................................................................#........................
...........................................................................................................#................#...............
#..............#...................#.............................................#........................................................#.
.........................................#.........................................................#........................................
.....................#............................................#.....................#...................................................
.................................................#......#...................................................................................
.........................................................................................................#..............#.......#...........
...............................#..................................................................................#...................#.....
..........................#.........................#...........#..............#..........#..................#..............................
..........................................#.............................#...................................................................
............#......#................................................................................#.......................................
................................................................................................................#.....#....................#
...#.........................#................#...............................................................................#.............
......................#..................................#.............................#...................#................................
.......................................................................#.....#.................#............................................
.......#..................#.........................#....................................................................................#..
..........................................................................................#....................#............................
........................................#........................#.....................................................#....................
...................#.....................................................#.......#.............................................#............
..............................#.................#...........................................................................................
..#..................................................#......#................#.............................................#.........#.....#
...........#..................................................................................#.....................#.......................
.....................................................................................................#...........................#..........
................#......................#........................................................................#...........................
............................................................................................................................................
.......#..............#............#............................#......#................#.....................................#.............
............................................#........#.........................................#............................................
..............................#..............................................................................#.......................#......
............................................................................................................................................
....................#............................................................#..............................................#...........
......................................#..............................................................#...................................#..
..........#.....................#.......................................#..............#....................................................
............................................................................................................................................
....#.....................#..................#......#.......#.................#...........................................#.................
....................................#.........................................................#....................#.............#..........
....................................................................................................#.......................................
.................................................................#........................................#.................................
..................#...................................................................................................#.....................
.........................................................................#......................#...........................................
#......................................................#...........................#............................#.........#.................
...........................#............#..........................................................................................#........
..................................................................#......................#..................................................
................#................................#...........................#..............................................................
........#.....................................................................................................................#.............
...................................#........................................................................................................
.......................#.....#................................................................................#.............................
.#...........#...........................................#.................#....................#...........................................
..........................................................................................#............#................#...................
..........................#..........#......................................................................................................
.....#...............................................................................#.....................#.....................#..........
............................................................................................................................................
..........#............#................................#.....................#..................................#..........................
...............#...................#.........................#....................................#..................................#......
............................................................................................................................................
...........................................................................................................................................#
...#.....................................................................................................#..................................
......................#.............................#..........................#..............................#.............................
..........................................#...................#..........#..........................#...............#.......................
..............................#.....................................................................................................#.......
.........................................................#................................#.................................................
...............................................#............................................................................................
..........#...........................#..............#..........................#.........................#...................#.............
#.....................................................................................#.....................................................
.....#............................................................#..........................#.................#............................
...........................#.......#..............#.................................................................#.......................
.......................................................................................................#....................................
........#..........#.....................#..................#......................#......................................#...............#.
.............#.........................................................#....................................................................
................................................................#...........................................................................
.....#.................#.................................................................#......................#.....#..........#..........
................................#......#.............#.........................................#.....#......................................
...........................................................................#.........................................................#......
..........#................#................................................................................................................
.................................................#..............................#..........................................#................
.....................................................................................#.................#.........#..........................
.......................................................................#....................................#............................#..
...............#......#....................................#................................................................................
.........#...............................#..........#..........................................................................#............
...............................................................#.................#.........#.....#......................#...................
............................#.....#.........................................................................................................
......#..........................................#.......#...........................................................................#......
..............#...................................................#........................................#......#.........................
.............................................................................#..............................................................
.....................................#................................#................................................#....................
..........#..................#..............................#.............................#.................................................
....#.....................................................................#......#............................................#.............
......................#.................................#..............................................#....................................
.............#..............................................................................................................................
..........................................#......#...............................................#..........#...............................
.........................#......#.......................................................#...............................................#...
...........................................................#.................................#...................#..........................
...#...............#..................#..............#....................#...........................................#.....................
.....................................................................#...........#..........................................#......#........
..............................#...............#.................................................#......#....................................
........#.....#.............................................................................................................................
#........................................................#.............................#.......................................#.......#....
....................#..................................................#....................................................................
..........................................#......................#..........................................................................
.........................#...........................#.............................................#............#.........#.................
.....................................................................................................................#..............#.......
..........#...................................#............................................................#..................#.............
.....#..........#...................#........................................#..............................................................
.....................................................................#.........................#.......#....................................
......................#......#..............................................................................................................
.#......#...................................................................................................................................
.................................#....................................................#...........#......................#...............#..
.................#..................................#.........#.........#...........................................................#.......
..............................................#..................................#..........................................................
...........................#..........................................................................#.........#...........................
..........................................#.................................................................................................
.....................................#...........#..................#.........................................................#.............
..................#....................................#.............................#...........#........#.............#...................`;

// const p1Input = `
// ...#......
// .......#..
// #.........
// ..........
// ......#...
// .#........
// .........#
// ..........
// .......#..
// #...#.....`.trim();

type Matrix = string[][];

const parse = (text: string) =>
  text
    .split("\n")
    .filter(Boolean)
    .map((line) => line.split(""));

const col_n = (matrix: Matrix, n: number) => matrix.map((l) => l[n]);

const isSpace = (it: string) => it !== "#";

const matToString = (m: Matrix) => m.map((l) => l.join("")).join("\n");

const range = (n: number) => [...new Array(n)].map((_, i) => i);

const rotate_ccw = (matrix: Matrix) =>
  range(matrix[0].length).reduce<Matrix>(
    (nextRows, i) => [col_n(matrix, i), ...nextRows],
    []
  );

const expandRows = (matrix: Matrix, v = "1") =>
  matrix.flatMap((row) => {
    const isEmpty = row.every(isSpace);
    return isEmpty ? [row, row.map((_) => v)] : [row];
  });

const reduceMatrix = <T>(
  matrix: Matrix,
  cb: (acc: T, v: string, x: number, y: number) => T,
  init: T
) =>
  matrix.reduce(
    (acc1, row, x) => row.reduce((acc2, val, y) => cb(acc2, val, x, y), acc1),
    init
  );

const findGalaxyCoords = (matrix: Matrix) =>
  [
    ...reduceMatrix<Set<string>>(
      matrix,
      (all, v, x, y) => {
        if (v !== "#") return all;
        const key = `${x}_${y}`;
        all.add(key);
        return all;
      },
      new Set<string>()
    ),
  ].map((x) => x.split("_").map((x) => Number(x)) as [number, number]);

const expand = (matrix: Matrix, v = "1") =>
  rotate_ccw(
    rotate_ccw(rotate_ccw(expandRows(rotate_ccw(expandRows(matrix, v)), v)))
  );

const pairs = <T>(arr: T[]): [T, T][] => {
  if (arr.length < 2) return [];
  const [x, ...rest] = arr;
  return [...rest.map((y) => [x, y] as [T, T]), ...pairs(rest)];
};

const sum = (arr: number[]) => arr.reduce((t, i) => t + i, 0);

const distance = ([[x1, y1], [x2, y2]]: [[number, number], [number, number]]) =>
  Math.abs(x1 - x2) + Math.abs(y1 - y2);

const abs_distance_of_origin = (matrix: Matrix, [y, x]: [number, number]) => {
  const getVal = (v: string) => {
    return v === "M" ? 999_999 : v === "T" ? 9 : 1;
  };
  const dx = sum(matrix[y].filter((_, i) => i <= x).map(getVal));
  const dy = sum(
    col_n(matrix, x)
      .filter((_, i) => i <= y)
      .map(getVal)
  );
  return [dy, dx];
};

const distance2 = (
  matrix: Matrix,
  [p1, p2]: [[number, number], [number, number]]
) => {
  const [dy1, dx1] = abs_distance_of_origin(matrix, p1);
  const [dy2, dx2] = abs_distance_of_origin(matrix, p2);
  return Math.abs(dy2 - dy1) + Math.abs(dx2 - dx1);
};

function part1() {
  const universe = expand(parse(p1Input));
  const coords = [...findGalaxyCoords(universe).values()];
  const sum = pairs(coords)
    .map((pair) => distance2(universe, pair))
    .reduce((total, d) => total + d, 0);
  console.log(sum);
}

function part2() {
  const universe = expand(parse(p1Input), "M");
  const coords = [...findGalaxyCoords(universe)];
  const sum = pairs(coords)
    .map((pair) => distance2(universe, pair))
    .reduce((total, d) => total + d, 0);
  console.log(sum);
}

part1();
part2();
